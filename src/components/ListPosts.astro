---
import type { BlogEntry } from "@/types/contentful";

import PostCard from "@/components/PostCard";
import { cn } from "@/utils";

type Props = {
  FirstBig?: boolean;
  posts: BlogEntry[];
};

const { FirstBig = false, posts } = Astro.props;
const MAX_IMAGE_EAGER_LOAD = 2;
---

<section
  class={cn(
    `grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 mt-3`,
    FirstBig && `md:[&>*:first-child]:col-span-2`,
  )}
>
  {
    posts.map(async (post, index) => {
      // const { remarkPluginFrontmatter } = await post.fields.content.render();

      return (
        <PostCard
          data={{
            category: "fields" in post.fields.category ? post.fields.category.fields.title : "",
            description: post.fields.description,
            heroImage:
              "fields" in post.fields.heroImage && post.fields.heroImage.fields.file?.url
                ? post.fields.heroImage.fields.file?.url
                : "",
            pubDate: new Date(post.sys.createdAt), // Use sys.createdAt for the first published date
            title: post.fields.title,
          }}
          id={post.sys.id}
          imageEagerLoad={FirstBig && index < MAX_IMAGE_EAGER_LOAD ? true : false}
          readTime="place holder"
          slug={post.fields.slug}
        />
      );
    })
  }
</section>
