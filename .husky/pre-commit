# Function to output colored text
error_color() {
  echo -e "\e[31m$1\e[0m"
}

warning_color() {
  echo -e "\e[33m$1\e[0m"
}

# Function to check if the Go live block is uncommented
check_go_live_block() {
  start_comment=$(grep -n '^# Start Go live block' public/admin/config.yml | awk -F: '{print $1}')
  end_comment=$(grep -n '^# End Go live block' public/admin/config.yml | awk -F: '{print $1}')

  if [ -z "$start_comment" ] || [ -z "$end_comment" ]; then
    error_color "Error: Start or End Go live block not found"
    return 1
  fi

  start=$((start_comment + 1))
  end=$((end_comment - 1))

  for i in $(seq $start $end); do
    line=$(sed -n "${i}p" public/admin/config.yml)
    if [[ "$line" =~ ^#.* ]]; then
      error_color "Error: Line $i in Go live block is commented: $line"
      return 1
    fi
  done

  return 0
}

# Run the check
if ! check_go_live_block; then
  error_color "Error: Go live block is not properly uncommented!"
  warning_color "Verify this config for prod is present in public/admin/config.yml"
  exit 1
fi

npx lint-staged
